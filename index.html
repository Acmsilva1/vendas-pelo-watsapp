<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vendas</title>
    <link rel="manifest" href="/vendas-pelo-watsapp/manifest.json">
    <meta name="theme-color" content="#121212">
    <style>
        /* Vari√°veis de Cores Dark Mode */
        :root { 
            --wa: #25d366; 
            --pink: #ff4081; 
            --blue: #40c4ff;
            --bg: #121212; 
            --card-bg: #1e1e1e; 
            --text-main: #e0e0e0; 
            --text-sub: #b0b0b0;
            --border: #333333;
            --input-bg: #2d2d2d;
        }

        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text-main); padding: 15px; margin: 0; display: flex; justify-content: center; }
        
        .card { 
            background: var(--card-bg); 
            padding: 25px; 
            border-radius: 20px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); 
            width: 100%; 
            max-width: 850px; 
            border: 1px solid var(--border); 
        }

        h2 { color: var(--pink); text-align: center; margin-top: 0; font-size: 20px; text-transform: uppercase; letter-spacing: 1px; }
        
        .section { margin-bottom: 20px; background: var(--input-bg); padding: 15px; border-radius: 12px; border: 1px solid var(--border); }
        
        label { font-weight: bold; color: var(--pink); display: block; margin-bottom: 8px; font-size: 14px; }
        
        /* Grid de Pre√ßos */
        .price-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 15px; }
        .price-item { background: var(--card-bg); padding: 10px; border-radius: 10px; border: 1px solid var(--border); text-align: center; }
        .price-item label { font-size: 11px; margin-bottom: 4px; color: var(--text-sub); }
        .price-item input { width: 100%; border: none; font-size: 16px; font-weight: bold; text-align: center; color: var(--wa); outline: none; background: transparent; }

        /* Sauda√ß√£o */
        .saudacao-grid { display: flex; gap: 8px; margin-bottom: 10px; }
        .saudacao-grid label { flex: 1; display: flex; align-items: center; justify-content: center; background: var(--card-bg); border: 2px solid var(--border); padding: 12px; border-radius: 10px; cursor: pointer; font-size: 11px; color: var(--text-sub); transition: 0.3s; }
        .saudacao-grid input { display: none; }
        .saudacao-grid label:has(input:checked) { border-color: var(--pink); background: #3d1a26; color: var(--pink); font-weight: bold; }
        
        textarea, .input-text { width: 100%; padding: 12px; border-radius: 10px; border: 2px solid var(--border); font-size: 16px; box-sizing: border-box; background: var(--card-bg); color: var(--text-main); outline: none; }
        
        /* Foto */
        .foto-upload { background: #1a2a3a; border: 2px dashed var(--blue); padding: 15px; border-radius: 10px; text-align: center; cursor: pointer; color: var(--blue); font-weight: bold; }
        .preview-img { max-width: 120px; max-height: 120px; margin: 10px auto; border-radius: 8px; display: none; border: 2px solid var(--border); }
        
        /* Colunas de Sabores */
        .flex-container { display: flex; flex-wrap: wrap; gap: 20px; }
        .column { flex: 1; min-width: 250px; }
        .cat-title { background: var(--pink); color: white; padding: 10px; border-radius: 8px; font-weight: bold; margin-bottom: 12px; font-size: 13px; text-align: center; box-shadow: 0 4px 10px rgba(255, 64, 129, 0.3); }
        
        .list { display: flex; flex-direction: column; gap: 6px; }
        .item { display: flex; align-items: center; background: var(--input-bg); padding: 12px; border-radius: 10px; border: 1px solid var(--border); cursor: pointer; font-size: 13px; transition: 0.2s; }
        .item:hover { background: #333; }
        input[type="checkbox"] { margin-right: 12px; width: 22px; height: 22px; accent-color: var(--wa); }
        
        /* A√ß√µes */
        .btn-wa { background: var(--wa); color: #000; border: none; padding: 18px; border-radius: 12px; font-size: 16px; font-weight: bold; cursor: pointer; width: 100%; box-shadow: 0 4px 15px rgba(37, 211, 102, 0.4); margin-top: 10px; }
        .status-sheets { font-size: 10px; text-align: center; margin-top: 8px; color: var(--blue); font-style: italic; }
        
        .btn-clear { background: transparent; color: #ff5252; border: 1px solid #ff5252; padding: 8px 15px; border-radius: 8px; cursor: pointer; font-size: 11px; opacity: 0.6; transition: 0.3s; }
        .btn-clear:hover { opacity: 1; background: rgba(255, 82, 82, 0.1); }
    </style>
</head>
<body onload="carregarEstado()">

<div class="card">
    <h2>üç∞ DEL√çCIAS DA J√ö</h2>

    <div class="section">
        <label>üí∞ CONFIGURAR PRE√áOS (R$)</label>
        <div class="price-grid">
            <div class="price-item">
                <label>COMUM</label>
                <input type="number" id="p_comum" value="17.00" oninput="salvarEstado()">
            </div>
            <div class="price-item">
                <label>COBERTURA</label>
                <input type="number" id="p_cobertura" value="27.00" oninput="salvarEstado()">
            </div>
            <div class="price-item">
                <label>ESPECIAL</label>
                <input type="number" id="p_especial" value="35.00" oninput="salvarEstado()">
            </div>
        </div>
    </div>

    <div class="section">
        <label>üì∏ FOTO DA PRODU√á√ÉO</label>
        <label class="foto-upload">
            <span id="label-foto">CLIQUE PARA ANEXAR üì∑</span>
            <input type="file" id="fotoInput" accept="image/*" onchange="previewFoto(this)" style="display:none">
            <img id="preview" class="preview-img">
        </label>
    </div>

    <div class="section">
        <label>1. SAUDA√á√ÉO</label>
        <div class="saudacao-grid">
            <label><input type="radio" name="saudacao" value="Bom dia ‚òï" onchange="salvarEstado()"> Bom dia ‚òï</label>
            <label><input type="radio" name="saudacao" value="Boa tarde ‚òÄÔ∏è" onchange="salvarEstado()"> Boa tarde ‚òÄÔ∏è</label>
            <label><input type="radio" name="saudacao" value="Boa noite ‚ú®" onchange="salvarEstado()"> Boa noite ‚ú®</label>
        </div>
    </div>

    <div class="section">
        <label>2. T√çTULO DO POST</label>
        <input type="text" id="titulo" class="input-text" placeholder="Ex: vizinhos! Bolo caseiro..." oninput="salvarEstado()">
    </div>

    <div class="flex-container">
        <div class="column">
            <div class="cat-title">BOLOS COMUNS</div>
            <div id="lista-comum" class="list"></div>
        </div>
        <div class="column">
            <div class="cat-title">COM COBERTURA</div>
            <div id="lista-especial" class="list"></div>
        </div>
        <div class="column" id="col-especial" style="display:none">
            <div class="cat-title">ESPECIAIS üåü</div>
            <div id="lista-vips" class="list"></div>
        </div>
    </div>

    <div class="section" style="margin-top:20px;">
        <label>4. RODAP√â E PAGAMENTO</label>
        <textarea id="rodape" rows="5" oninput="salvarEstado()"></textarea>
    </div>

    <button class="btn-wa" onclick="enviarTudo()">üöÄ POSTAR E SALVAR NO SHEETS</button>
    <div id="status" class="status-sheets"></div>

    <div style="text-align: center; margin-top: 30px; border-top: 1px dashed var(--border); padding-top: 15px;">
        <button class="btn-clear" onclick="limparTudo()">üóëÔ∏è RECOME√áAR / LIMPAR TUDO</button>
    </div>
</div>

<script>
    const URL_SHEETS = "https://script.google.com/macros/s/AKfycbyTX9Etnf3aoo2_WbUjb4zmuKRbMhBkJBeRjk9Um-sKkpKLrvHzmgAAe9AEXYFthJUekQ/exec";

    // PWA Service Worker
    if ('serviceWorker' in navigator) { 
        navigator.serviceWorker.register('/vendas-pelo-watsapp/sw.js'); 
    }

    // LISTAS DE SABORES (Adicione novos aqui!)
    const saboresComuns = ["CHOCOLATE", "CENOURA", "FUB√Å", "MILHO", "LARANJA", "LIM√ÉO", "NINHO", "PA√áOCA", "BANANA"];
    const saboresCobertura = ["CHOCOLATE COM CHOCOLATE", "CHOCOLATE COM NINHO", "CENOURA COM CHOCOLATE", "NINHO COM CHOCOLATE", "NINHO COM NINHO", "FUB√Å COM GOIABADA", "CHURROS", "ABACAXI CARAMELADO", "BANANA CARAMELADA", "CUCA DE BANANA", "PA√áOCA COM DOCE DE LEITE"];
    const saboresEspeciais = []; // Quando preencher, a 3¬™ coluna aparece

    function renderizarSabores() {
        const cDiv = document.getElementById('lista-comum');
        const eDiv = document.getElementById('lista-especial');
        const vDiv = document.getElementById('lista-vips');
        cDiv.innerHTML = ""; eDiv.innerHTML = ""; vDiv.innerHTML = "";

        saboresComuns.forEach(s => cDiv.innerHTML += criarItem(s, 'COMUM'));
        saboresCobertura.forEach(s => eDiv.innerHTML += criarItem(s, 'COB'));
        
        if(saboresEspeciais.length > 0) {
            document.getElementById('col-especial').style.display = 'block';
            saboresEspeciais.forEach(s => vDiv.innerHTML += criarItem(s, 'ESP'));
        }
    }

    function criarItem(nome, cat) {
        return `<label class="item"><input type="checkbox" class="sabor" data-nome="${nome}" data-cat="${cat}" onchange="salvarEstado()"> ${nome}</label>`;
    }

    // L√≥gica do Google Sheets
    async function registrarNoSheets(selecionados, precos) {
        document.getElementById('status').innerText = "‚åõ Sincronizando com Sheets...";
        const dados = {
            hora: new Date().toLocaleTimeString('pt-BR'),
            diaSemana: new Date().toLocaleDateString('pt-BR', {weekday: 'long'}),
            titulo: document.getElementById('titulo').value,
            sabores: selecionados,
            precos: precos
        };

        try {
            // Mode no-cors √© necess√°rio para Google Apps Script
            await fetch(URL_SHEETS, { method: 'POST', mode: 'no-cors', body: JSON.stringify(dados) });
            document.getElementById('status').innerText = "‚úÖ Registro salvo na planilha!";
        } catch (e) {
            document.getElementById('status').innerText = "‚ùå Erro ao salvar insight (verifique a internet)";
        }
    }

    function previewFoto(input) {
        const preview = document.getElementById('preview');
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = e => { preview.src = e.target.result; preview.style.display = 'block'; }
            reader.readAsDataURL(input.files[0]);
        }
    }

    function salvarEstado() {
        const estado = {
            precos: {
                comum: document.getElementById('p_comum').value,
                cob: document.getElementById('p_cobertura').value,
                esp: document.getElementById('p_especial').value
            },
            saudacao: document.querySelector('input[name="saudacao"]:checked')?.value || "Bom dia ‚òï",
            titulo: document.getElementById('titulo').value,
            rodape: document.getElementById('rodape').value,
            selecionados: Array.from(document.querySelectorAll('.sabor:checked')).map(cb => cb.getAttribute('data-nome'))
        };
        localStorage.setItem('ju_v8_sheets', JSON.stringify(estado));
    }

    function carregarEstado() {
        renderizarSabores();
        const salvo = localStorage.getItem('ju_v8_sheets');
        if (salvo) {
            const e = JSON.parse(salvo);
            document.getElementById('p_comum').value = e.precos.comum;
            document.getElementById('p_cobertura').value = e.precos.cob;
            document.getElementById('p_especial').value = e.precos.esp;
            document.getElementById('titulo').value = e.titulo;
            document.getElementById('rodape').value = e.rodape;
            document.querySelectorAll('input[name="saudacao"]').forEach(r => { if(r.value === e.saudacao) r.checked = true; });
            document.querySelectorAll('.sabor').forEach(cb => { if(e.selecionados.includes(cb.getAttribute('data-nome'))) cb.checked = true; });
        } else {
            // Valores padr√£o se for a primeira vez
            document.getElementById('titulo').value = "vizinhos! Bolo caseiro sob demanda ‚ö†Ô∏è";
            document.getElementById('rodape').value = "Aceitamos:\nüí≤ PIX\nüíµ Dinheiro\nüí≥ Cart√£o por aproxima√ß√£o\n\nDel√≠cias da J√∫ üíû";
        }
    }

    function limparTudo() {
        if(confirm("‚ö†Ô∏è ATEN√á√ÉO: Deseja apagar todos os pre√ßos, sabores marcados e textos? Isso n√£o apaga o hist√≥rico do Sheets.")) {
            localStorage.removeItem('ju_v8_sheets');
            location.reload();
        }
    }

    async function enviarTudo() {
        const sel = document.querySelectorAll('.sabor:checked');
        if (sel.length === 0) { alert("Selecione pelo menos um bolo!"); return; }

        const listaNomes = Array.from(sel).map(s => s.getAttribute('data-nome'));
        const precos = {
            comum: document.getElementById('p_comum').value,
            cob: document.getElementById('p_cobertura').value,
            esp: document.getElementById('p_especial').value
        };

        // Salvar Insight no Google Sheets
        registrarNoSheets(listaNomes, precos);

        // Montar Mensagem WhatsApp
        let msg = `*${document.querySelector('input[name="saudacao"]:checked').value} ${document.getElementById('titulo').value}*\n\n*SABORES DISPON√çVEIS:* üòã\n\n`;
        
        const filtrar = (cat) => Array.from(sel).filter(s => s.getAttribute('data-cat') === cat);
        const comuns = filtrar('COMUM');
        const cobs = filtrar('COB');
        const esps = filtrar('ESP');

        if(comuns.length > 0) { msg += `ü•ß *COMUM: ${precos.comum} R$*\n`; comuns.forEach(s => msg += `‚úÖ ${s.getAttribute('data-nome')}\n`); msg += `\n`; }
        if(cobs.length > 0) { msg += `üç∞ *COM COBERTURA: ${precos.cob} R$*\n`; cobs.forEach(s => msg += `‚úÖ ${s.getAttribute('data-nome')}\n`); msg += `\n`; }
        if(esps.length > 0) { msg += `üåü *ESPECIAL: ${precos.esp} R$*\n`; esps.forEach(s => msg += `‚úÖ ${s.getAttribute('data-nome')}\n`); msg += `\n`; }
        
        msg += document.getElementById('rodape').value;

        // Compartilhamento Nativo (Web Share API)
        const files = document.getElementById('fotoInput').files;
        if (files.length > 0 && navigator.share) {
            try { await navigator.share({ files: [files[0]], text: msg }); return; } catch (err) { console.log("Share failed", err); }
        }
        
        if (navigator.share) { 
            await navigator.share({ text: msg }); 
        } else { 
            window.open("https://api.whatsapp.com/send?text=" + encodeURIComponent(msg)); 
        }
    }
</script>
</body>
</html>
