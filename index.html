<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vendas pelo WhatsApp - J√∫</title>
    
    <link rel="manifest" href="/vendas-pelo-watsapp/manifest.json">
    <meta name="theme-color" content="#d81b60">
    
    <style>
        :root { --wa: #25d366; --pink: #d81b60; --blue: #34b7f1; }
        body { font-family: 'Segoe UI', sans-serif; background: #e5e5e5; padding: 15px; margin: 0; display: flex; justify-content: center; }
        .card { background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 100%; max-width: 850px; }
        h2 { color: var(--pink); text-align: center; margin-top: 0; font-size: 20px; text-transform: uppercase; letter-spacing: 1px; }
        .section { margin-bottom: 20px; background: #fdfdfd; padding: 15px; border-radius: 12px; border: 1px solid #eee; }
        label { font-weight: bold; color: #555; display: block; margin-bottom: 8px; font-size: 14px; }
        .saudacao-grid { display: flex; gap: 8px; margin-bottom: 10px; }
        .saudacao-grid label { flex: 1; display: flex; align-items: center; justify-content: center; background: #fff; border: 2px solid #eee; padding: 12px; border-radius: 10px; cursor: pointer; font-size: 12px; }
        .saudacao-grid input { display: none; }
        .saudacao-grid label:has(input:checked) { border-color: var(--pink); background: #fff5f8; color: var(--pink); font-weight: bold; }
        input[type="text"], textarea { width: 100%; padding: 12px; border-radius: 10px; border: 2px solid #eee; font-size: 16px; outline: none; box-sizing: border-box; }
        .foto-upload { background: #f0f7ff; border: 2px dashed var(--blue); padding: 15px; border-radius: 10px; text-align: center; cursor: pointer; display: block; }
        .preview-img { max-width: 100px; max-height: 100px; margin-top: 10px; border-radius: 8px; display: none; margin-left: auto; margin-right: auto; }
        .flex-container { display: flex; flex-wrap: wrap; gap: 20px; }
        .column { flex: 1; min-width: 280px; }
        .cat-title { background: var(--pink); color: white; padding: 10px; border-radius: 8px; font-weight: bold; margin-bottom: 12px; font-size: 13px; text-align: center; }
        .list { display: flex; flex-direction: column; gap: 6px; }
        .item { display: flex; align-items: center; background: #fff; padding: 12px; border-radius: 10px; border: 1px solid #eee; cursor: pointer; font-size: 13px; }
        input[type="checkbox"] { margin-right: 12px; width: 22px; height: 22px; accent-color: var(--wa); }
        .actions { display: flex; flex-direction: column; gap: 10px; margin-top: 25px; }
        .btn-wa { background: var(--wa); color: white; border: none; padding: 18px; border-radius: 12px; font-size: 16px; font-weight: bold; cursor: pointer; }
        .btn-clear { background: #666; color: white; border: none; padding: 10px; border-radius: 12px; cursor: pointer; font-size: 12px; opacity: 0.8; }
    </style>
</head>
<body onload="carregarEstado()">

<div class="card">
    <h2>üì± Vendas pelo WhatsApp</h2>

    <div class="section">
        <label>üì∏ Foto da Produ√ß√£o:</label>
        <label class="foto-upload">
            <span id="label-foto">Clique para selecionar a foto üì∑</span>
            <input type="file" id="fotoInput" accept="image/*" onchange="previewFoto(this)" style="display:none">
            <img id="preview" class="preview-img">
        </label>
    </div>

    <div class="section">
        <label>1. Sauda√ß√£o:</label>
        <div class="saudacao-grid">
            <label><input type="radio" name="saudacao" value="Bom dia ‚òï" onchange="salvarEstado()"> Bom dia ‚òï</label>
            <label><input type="radio" name="saudacao" value="Boa tarde ‚òÄÔ∏è" onchange="salvarEstado()"> Boa tarde ‚òÄÔ∏è</label>
            <label><input type="radio" name="saudacao" value="Boa noite ‚ú®" onchange="salvarEstado()"> Boa noite ‚ú®</label>
        </div>
    </div>

    <div class="section">
        <label>2. T√≠tulo:</label>
        <input type="text" id="titulo" oninput="salvarEstado()">
    </div>

    <div class="flex-container">
        <div class="column">
            <div class="cat-title">BOLOS COMUNS (R$ 17,00)</div>
            <div id="lista-comum" class="list"></div>
        </div>
        <div class="column">
            <div class="cat-title">COM COBERTURA (R$ 27,00)</div>
            <div id="lista-especial" class="list"></div>
        </div>
    </div>

    <div class="section" style="margin-top:20px;">
        <label>4. Rodap√©:</label>
        <textarea id="rodape" rows="5" oninput="salvarEstado()"></textarea>
    </div>

    <div class="actions">
        <button class="btn-wa" onclick="enviarTudo()">üöÄ ENVIAR PARA WHATSAPP</button>
        <button class="btn-clear" onclick="limparTudo()">üóëÔ∏è RESETAR TUDO</button>
    </div>
</div>

<script>
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/vendas-pelo-watsapp/sw.js');
    }

    const saboresComuns = ["CHOCOLATE", "CENOURA", "FUB√Å", "MILHO", "LARANJA", "LIM√ÉO", "NINHO", "PA√áOCA", "BANANA"];
    const saboresEspeciais = ["CHOCOLATE COM CHOCOLATE", "CHOCOLATE COM NINHO", "CENOURA COM CHOCOLATE", "NINHO COM CHOCOLATE", "NINHO COM NINHO", "FUB√Å COM GOIABADA", "CHURROS", "ABACAXI CARAMELADO", "BANANA CARAMELADA", "CUCA DE BANANA", "PA√áOCA COM DOCE DE LEITE"];

    function renderizarSabores() {
        const cDiv = document.getElementById('lista-comum');
        const eDiv = document.getElementById('lista-especial');
        cDiv.innerHTML = ""; eDiv.innerHTML = ""; // Evita duplica√ß√£o

        saboresComuns.forEach(s => {
            cDiv.innerHTML += `<label class="item"><input type="checkbox" class="sabor" data-nome="${s}" data-cat="COMUM" onchange="salvarEstado()"> ${s}</label>`;
        });
        saboresEspeciais.forEach(s => {
            eDiv.innerHTML += `<label class="item"><input type="checkbox" class="sabor" data-nome="${s}" data-cat="ESP" onchange="salvarEstado()"> ${s}</label>`;
        });
    }

    function previewFoto(input) {
        const preview = document.getElementById('preview');
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = e => { preview.src = e.target.result; preview.style.display = 'block'; }
            reader.readAsDataURL(input.files[0]);
        }
    }

    function salvarEstado() {
        const estado = {
            saudacao: document.querySelector('input[name="saudacao"]:checked')?.value || "Bom dia ‚òï",
            titulo: document.getElementById('titulo').value,
            rodape: document.getElementById('rodape').value,
            selecionados: Array.from(document.querySelectorAll('.sabor:checked')).map(cb => cb.getAttribute('data-nome'))
        };
        localStorage.setItem('ju_v5_vendas', JSON.stringify(estado));
    }

    function carregarEstado() {
        renderizarSabores();
        const salvo = localStorage.getItem('ju_v5_vendas');
        if (salvo) {
            const e = JSON.parse(salvo);
            document.getElementById('titulo').value = e.titulo;
            document.getElementById('rodape').value = e.rodape;
            document.querySelectorAll('input[name="saudacao"]').forEach(r => { if(r.value === e.saudacao) r.checked = true; });
            document.querySelectorAll('.sabor').forEach(cb => { if(e.selecionados.includes(cb.getAttribute('data-nome'))) cb.checked = true; });
        } else {
            document.getElementById('titulo').value = "vizinhos! Bolo caseiro sob demanda ‚ö†Ô∏è";
            document.getElementById('rodape').value = "Aceitamos:\nüí≤ PIX\nüíµ Dinheiro\nüí≥ Cart√£o por aproxima√ß√£o\n\nDel√≠cias da J√∫ üíû";
        }
    }

    function limparTudo() { if(confirm("Limpar tudo?")) { localStorage.removeItem('ju_v5_vendas'); location.reload(); } }

    async function enviarTudo() {
        const sel = document.querySelectorAll('.sabor:checked');
        if (sel.length === 0) { alert("Escolha os sabores!"); return; }

        let msg = `*${document.querySelector('input[name="saudacao"]:checked').value} ${document.getElementById('titulo').value}*\n\n*SABORES:* üòã\n\n`;
        const comuns = Array.from(sel).filter(s => s.getAttribute('data-cat') === 'COMUM');
        const esps = Array.from(sel).filter(s => s.getAttribute('data-cat') === 'ESP');

        if(comuns.length > 0) { msg += `ü•ß *COMUM: 17,00 R$*\n`; comuns.forEach(s => msg += `‚úÖ ${s.getAttribute('data-nome')}\n`); msg += `\n`; }
        if(esps.length > 0) { msg += `üç∞ *COM COBERTURA: 27,00 R$*\n`; esps.forEach(s => msg += `‚úÖ ${s.getAttribute('data-nome')}\n`); msg += `\n`; }
        msg += document.getElementById('rodape').value;

        const files = document.getElementById('fotoInput').files;
        if (files.length > 0 && navigator.canShare && navigator.canShare({ files: [files[0]] })) {
            try { await navigator.share({ files: [files[0]], text: msg }); return; } catch (err) {}
        }
        if (navigator.share) { await navigator.share({ text: msg }); } 
        else { window.open("https://api.whatsapp.com/send?text=" + encodeURIComponent(msg)); }
    }
</script>
</body>
</html>
